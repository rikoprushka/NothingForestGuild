<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nothing Forest Pixel Fighter</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: "Press Start 2P", system-ui;
            color: #e2e8f0;
            padding-top: 50px;
        }
        @keyframes wiggle {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(-5deg); }
            75% { transform: rotate(5deg); }
            100% { transform: rotate(0deg); }
        }
        .wiggle:hover {
            animation: wiggle 0.5s ease-in-out;
        }
        @keyframes blink {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        .blink {
            animation: blink 0.5s infinite;
        }
        @keyframes jump {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        .jump {
            animation: jump 0.5s infinite;
        }
        @keyframes sparkle {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }
        .sparkle {
            position: absolute;
            width: 5px;
            height: 5px;
            background-color: yellow;
            border-radius: 50%;
            animation: sparkle 0.5s infinite;
        }
        @keyframes collapse {
            0% { transform: translateY(0) rotate(0deg); }
            100% { transform: translateY(50%) rotate(90deg); }
        }
        .collapsed {
            animation: collapse 1s forwards;
            filter: grayscale(100%);
        }
        .damage-text {
            position: absolute;
            color: red;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 2px 2px 0 #000;
            animation: float-up 1s forwards;
            z-index: 10;
        }
        .heal-text {
            position: absolute;
            color: #00ff00;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 2px 2px 0 #000;
            animation: float-up 1s forwards;
            z-index: 10;
        }
        @keyframes float-up {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-50px); opacity: 0; }
        }
        .fighting-area {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
            margin-bottom: 1px;
        }
        .health-bar, .mana-bar {
            height: 15px;
            transition: width 0.3s ease-in-out;
        }
        .character {
            position: absolute;
            bottom: 0;
            width: 250px;
            height: 250px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: bottom center;
            transition: transform 0.3s ease-in-out, filter 0.5s ease-in-out;
        }
        #player1 {
            left: 25%;
            transform: translateX(-50%) scaleX(-1);
        }
        #player2 {
            right: 25%;
            transform: translateX(50%);
        }
        @keyframes attack-right {
            0%, 100% { transform: translateX(-50%) scaleX(-1); }
            50% { transform: translateX(-40%) scaleX(-1); }
        }
        @keyframes attack-left {
            0%, 100% { transform: translateX(50%); }
            50% { transform: translateX(40%); }
        }
        .attack-right {
            animation: attack-right 0.3s;
        }
        .attack-left {
            animation: attack-left 0.3s;
        }
        @keyframes hit {
            0%, 100% { filter: none; }
            50% { filter: brightness(2) saturate(2); }
        }
        .hit {
            animation: hit 0.2s;
        }
        .emoji {
            position: absolute;
            font-size: 32px;
            transition: all 2s ease-in-out;
            z-index: 1000;
        }
        @keyframes float-emoji {
            0% { transform: translate(0, 0) scale(1); opacity: 1; }
            100% { transform: translate(200px, -100px) scale(2); opacity: 0; }
        }
        @keyframes heal {
            0% { box-shadow: 0 0 0 0 rgba(0, 255, 0, 0.4); }
            70% { box-shadow: 0 0 0 20px rgba(0, 255, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 255, 0, 0); }
        }
        .heal {
            animation: heal 1s ease-in-out;
        }
        @keyframes gradient-bg {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .animate-gradient-bg {
            background-size: 200% 200%;
            animation: gradient-bg 15s ease infinite;
        }
        #battleLog {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            backdrop-filter: blur(10px);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
            margin-top: 1px;
        }
        .top-bar-bg {
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }
        #elapsedTime {
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            background-color: transparent;
            backdrop-filter: none;
        }
        @keyframes rainbow-flow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .rainbow-bg {
            background: linear-gradient(125deg,
                #B71C1C, #0f172a, #880E4F, #0f172a, #4A148C, #0f172a, #311B92, #0f172a,
                #1A237E, #0f172a, #0D47A1, #0f172a, #01579B, #0f172a, #006064, #0f172a,
                #004D40, #0f172a, #1B5E20, #0f172a, #33691E, #0f172a, #E65100, #0f172a,
                #BF360C, #0f172a, #B71C1C, #0f172a, #880E4F, #0f172a, #4A148C, #0f172a,
                #311B92, #0f172a, #1A237E, #0f172a, #0D47A1, #0f172a, #01579B, #0f172a,
                #006064, #0f172a, #004D40, #0f172a, #1B5E20, #0f172a, #33691E, #0f172a,
                #E65100, #0f172a);
            background-size: 10000% 10000%;
            animation: rainbow-flow 720s ease infinite;
        }
        #credits {
            margin-top: 20px;
            text-align: center;
            font-size: 12px;
            color: #a0aec0;
        }
        #credits a {
            color: #a0aec0;
            text-decoration: none;
            transition: text-decoration 0.3s ease-in-out;
        }
        #credits a:hover {
            text-decoration: underline;
            animation: smoothBlink 1.5s linear infinite;
        }
        @keyframes smoothBlink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }
        @keyframes hover-jump {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .character-button:hover img {
            animation: hover-jump 0.5s ease-in-out infinite;
        }
        .character-button.selected img {
            animation: hover-jump 0.5s ease-in-out infinite;
        }
        @keyframes rainbow {
            0% { color: red; }
            14% { color: orange; }
            28% { color: yellow; }
            42% { color: green; }
            57% { color: blue; }
            71% { color: indigo; }
            85% { color: violet; }
            100% { color: red; }
        }
        
        .rainbow-text {
            animation: rainbow 4s linear infinite;
        }
        #howToPlayMenu {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 20px;
            border-radius: 10px;
            z-index: 1000;
            max-width: 80%;
            max-height: 80%;
            overflow-y: auto;
        }

        #howToPlayMenu h2 {
            color: #FFD700;
            margin-bottom: 15px;
        }

        #howToPlayMenu ul {
            list-style-type: none;
            padding: 0;
        }

        #howToPlayMenu li {
            margin-bottom: 10px;
        }

        #howToPlayMenu .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-gray-900 text-white">
    <div class="fixed inset-0 z-[-1] rainbow-bg opacity-100"></div>
    <div id="characterSelection" class="fixed inset-0 bg-gradient-to-br from-gray-900 to-gray-800 flex flex-col items-center justify-center overflow-auto py-8">
        <h1 class="text-4xl font-bold mb-8 text-yellow-400 shadow-lg">Choose Your Fighters</h1>
        <h2 id="selectedCharacterNames" class="text-2xl mb-4 text-center"></h2>
        <div id="characterGrid" class="grid grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-4 mb-8"></div>
        <div class="flex space-x-8 mb-8">
            <button id="randomSelectBtn" class="relative overflow-hidden bg-[#243044]/30 backdrop-blur-md text-blue-300 py-4 px-10 rounded-xl text-xl font-bold border border-blue-500/50 shadow-[0_0_15px_rgba(59,130,246,0.5)] transition-all duration-300 ease-in-out hover:shadow-[0_0_25px_rgba(59,130,246,0.8)] hover:text-white group">
              <span class="relative z-10 transition-transform duration-300 group-hover:scale-110">Random Selection</span>
              <span class="absolute inset-0 bg-gradient-to-r from-blue-600 to-cyan-500 opacity-0 group-hover:opacity-20 transition-opacity duration-300"></span>
              <span class="absolute top-0 left-0 w-full h-0.5 bg-gradient-to-r from-transparent via-blue-500 to-transparent transform scale-x-0 group-hover:scale-x-100 transition-transform duration-500"></span>
              <span class="absolute bottom-0 right-0 w-full h-0.5 bg-gradient-to-r from-transparent via-blue-500 to-transparent transform scale-x-0 group-hover:scale-x-100 transition-transform duration-500"></span>
              <span class="absolute top-0 left-0 w-0.5 h-full bg-gradient-to-b from-transparent via-blue-500 to-transparent transform scale-y-0 group-hover:scale-y-100 transition-transform duration-500"></span>
              <span class="absolute top-0 right-0 w-0.5 h-full bg-gradient-to-b from-transparent via-blue-500 to-transparent transform scale-y-0 group-hover:scale-y-100 transition-transform duration-500"></span>
            </button>
            <button id="startGameBtn" disabled class="relative overflow-hidden bg-[#243044]/30 backdrop-blur-md text-green-300 py-4 px-10 rounded-xl text-xl font-bold border border-green-500/50 shadow-[0_0_15px_rgba(34,197,94,0.5)] transition-all duration-300 ease-in-out hover:shadow-[0_0_25px_rgba(34,197,94,0.8)] hover:text-white group disabled:opacity-50 disabled:cursor-not-allowed">
              <span class="relative z-10 transition-transform duration-300 group-hover:scale-110">Start Game</span>
              <span class="absolute inset-0 bg-gradient-to-r from-green-600 to-emerald-500 opacity-0 group-hover:opacity-20 transition-opacity duration-300"></span>
              <span class="absolute top-0 left-0 w-full h-0.5 bg-gradient-to-r from-transparent via-green-500 to-transparent transform scale-x-0 group-hover:scale-x-100 transition-transform duration-500"></span>
              <span class="absolute bottom-0 right-0 w-full h-0.5 bg-gradient-to-r from-transparent via-green-500 to-transparent transform scale-x-0 group-hover:scale-x-100 transition-transform duration-500"></span>
              <span class="absolute top-0 left-0 w-0.5 h-full bg-gradient-to-b from-transparent via-green-500 to-transparent transform scale-y-0 group-hover:scale-y-100 transition-transform duration-500"></span>
              <span class="absolute top-0 right-0 w-0.5 h-full bg-gradient-to-b from-transparent via-green-500 to-transparent transform scale-y-0 group-hover:scale-y-100 transition-transform duration-500"></span>
            </button>
          </div>
        <div class="flex space-x-4 mb-4">
            <div>
                <label for="p1MinDamage" class="block text-sm font-medium text-gray-300">P1 Min Damage:</label>
                <input type="number" id="p1MinDamage" class="mt-1 block w-full rounded-md bg-gray-700 border-gray-600 text-white" value="1" min="1" max="99">
            </div>
            <div>
                <label for="p1MaxDamage" class="block text-sm font-medium text-gray-300">P1 Max Damage:</label>
                <input type="number" id="p1MaxDamage" class="mt-1 block w-full rounded-md bg-gray-700 border-gray-600 text-white" value="99" min="1" max="99">
            </div>
            <div>
                <label for="p2MinDamage" class="block text-sm font-medium text-gray-300">P2 Min Damage:</label>
                <input type="number" id="p2MinDamage" class="mt-1 block w-full rounded-md bg-gray-700 border-gray-600 text-white" value="1" min="1" max="99">
            </div>
            <div>
                <label for="p2MaxDamage" class="block text-sm font-medium text-gray-300">P2 Max Damage:</label>
                <input type="number" id="p2MaxDamage" class="mt-1 block w-full rounded-md bg-gray-700 border-gray-600 text-white" value="99" min="1" max="99">
            </div>
        </div>
        <div class="flex space-x-4 mb-4">
            <div>
                <label for="p1MaxHP" class="block text-sm font-medium text-gray-300">P1 Max HP:</label>
                <input type="number" id="p1MaxHP" class="mt-1 block w-full rounded-md bg-gray-700 border-gray-600 text-white" value="1000" min="1" max="10000">
            </div>
            <div>
                <label for="p2MaxHP" class="block text-sm font-medium text-gray-300">P2 Max HP:</label>
                <input type="number" id="p2MaxHP" class="mt-1 block w-full rounded-md bg-gray-700 border-gray-600 text-white" value="1000" min="1" max="10000">
            </div>
        </div>
    </div>

    <div id="gameArea" class="hidden fixed inset-0 flex flex-col justify-between mx-auto pt-[50px]" style="width: 1280px; height: 720px; background-size: cover; background-position: center;">
        <div class="top-bar-bg bg-gray-700 h-24 flex justify-between items-center px-4 rounded-[20px]" style="background: none;">
            <div class="flex flex-col items-start">
                <div id="player1Name" class="text-lg mb-1"></div>
                <div id="player1HealthContainer" class="w-96 h-5 bg-[#243044]/30 backdrop-blur-md rounded-xl overflow-hidden relative border border-blue-500/50 shadow-[0_0_15px_rgba(59,130,246,0.5)] mb-1">
                    <div id="player1Health" class="health-bar h-full bg-gradient-to-r from-red-800 to-red-600"></div>
                    <div id="player1HPText" class="absolute inset-0 flex items-center justify-center text-white text-xs"></div>
                </div>
                <div id="player1ManaContainer" class="w-96 h-5 bg-[#243044]/30 backdrop-blur-md rounded-xl overflow-hidden relative border border-blue-500/50 shadow-[0_0_15px_rgba(59,130,246,0.5)]">
                    <div id="player1Mana" class="mana-bar h-full bg-gradient-to-r from-blue-800 to-blue-600"></div>
                    <div id="player1ManaText" class="absolute inset-0 flex items-center justify-center text-white text-xs"></div>
                </div>
            </div>
            <div id="elapsedTime" class="text-xl font-bold text-yellow-400"></div>
            <div class="flex flex-col items-end">
                <div id="player2Name" class="text-lg mb-1"></div>
                <div id="player2HealthContainer" class="w-96 h-5 bg-[#243044]/30 backdrop-blur-md rounded-xl overflow-hidden relative border border-green-500/50 shadow-[0_0_15px_rgba(34,197,94,0.5)] mb-1">
                    <div id="player2Health" class="health-bar h-full bg-gradient-to-l from-red-800 to-red-600 float-right"></div>
                    <div id="player2HPText" class="absolute inset-0 flex items-center justify-center text-white text-xs"></div>
                </div>
                <div id="player2ManaContainer" class="w-96 h-5 bg-[#243044]/30 backdrop-blur-md rounded-xl overflow-hidden relative border border-green-500/50 shadow-[0_0_15px_rgba(34,197,94,0.5)]">
                    <div id="player2Mana" class="mana-bar h-full bg-gradient-to-l from-blue-800 to-blue-600 float-right"></div>
                    <div id="player2ManaText" class="absolute inset-0 flex items-center justify-center text-white text-xs"></div>
                </div>
            </div>
        </div>
        <div id="countdown" class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-8xl font-bold text-yellow-400 hidden"></div>
        <div class="fighting-area flex-grow">
            <div id="player1" class="character"></div>
            <div id="player2" class="character"></div>
        </div>
        <div id="battleLog" class="bg-transparent border border-transparent text-white p-4 overflow-y-auto text-xs flex flex-col items-center h-[200px]"></div>
        <div class="p-4 flex justify-center">
            <button id="refreshBtn" class="bg-white/30 backdrop-blur-lg border border-white/10 text-white py-2 px-4 rounded-full text-sm shadow-lg transition duration-300 ease-in-out transform hover:scale-105">
                Back
            </button>
        </div>
        <div id="credits">
            <p>All assets are copyrighted by
            <a href="https://x.com/NothingJioo" target="_blank" rel="noopener noreferrer">@NothingJioo</a></p>
            <a href="https://www.twitch.tv/jiooooooooooooooooooooooo" target="_blank" rel="noopener noreferrer">
                twitch.tv/jiooooooooooooooooooooooo
            </a>
            <p>Created by Riko Prushka</p>
        </div>
    </div>

    <div id="winnerAnnouncement" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center hidden">
        <div class="bg-white bg-opacity-20 backdrop-filter backdrop-blur-lg text-white p-8 rounded-lg text-center relative max-w-2xl">
            <button id="closeWinnerCard" class="absolute top-2 right-2 text-gray-400 hover:text-white">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <h2 class="text-3xl font-bold mb-4" style="color: #BFA100;">Winner!</h2>
            <p id="winnerName" class="text-xl mb-4"></p>
            <img id="winnerImage" src="" alt="Winner" class="w-48 h-auto mx-auto mb-4">
            <div id="battleSummary" class="text-left mt-4 text-sm">
                <p id="damageDealt"></p>
                <p id="healingAmount"></p>
                <p id="emojiThrown"></p>
                <p id="manaUsed"></p>
            </div>
        </div>
    </div>

    <div id="howToPlayMenu">
        <button class="close-btn">&times;</button>
        <h2>How to Play</h2>
        <ul>
            <li>Select two characters to start the game.</li>
            <li>Watch as the characters automatically battle each other.</li>
            <li>Characters can attack, defend, or throw special items.</li>
            <li>The battle continues until one character's health reaches zero.</li>
            <li>Press 'B' to go to Screensaver.</li>
            <li>Press 'H' to toggle this How to Play menu.</li>
        </ul>
    </div>

    <script>
        const characterUrls = [
            'https://raw.githubusercontent.com/rikoprushka/NothingForestGuild/main/pixel/AnimalWillD0.png',
            'https://raw.githubusercontent.com/rikoprushka/NothingForestGuild/main/pixel/ano_hikari.png',
            'https://raw.githubusercontent.com/rikoprushka/NothingForestGuild/main/pixel/ArmyBangtanSonyeondan.png',
            'https://raw.githubusercontent.com/rikoprushka/NothingForestGuild/main/pixel/Arth101s.png',
            'https://raw.githubusercontent.com/rikoprushka/NothingForestGuild/main/pixel/ChocoMeow_Bs.png',
            'https://raw.githubusercontent.com/rikoprushka/NothingForestGuild/main/pixel/ChomPlu_PINK.png',
            'https://raw.githubusercontent.com/rikoprushka/NothingForestGuild/main/pixel/daiyas_diary.png',
            'https://raw.githubusercontent.com/rikoprushka/NothingForestGuild/main/pixel/darkwarkry.png',
            'https://raw.githubusercontent.com/rikoprushka/NothingForestGuild/main/pixel/FadeArtey199x.png',
            'https://raw.githubusercontent.com/rikoprushka/NothingForestGuild/main/pixel/fluffynaff.png',
            'https://raw.githubusercontent.com/rikoprushka/NothingForestGuild/main/pixel/gu_ball.png',
            'https://raw.githubusercontent.com/rikoprushka/NothingForestGuild/main/pixel/Ikunoreo.png',
            'https://raw.githubusercontent.com/rikoprushka/NothingForestGuild/main/pixel/jiooooooooooooooooooooooo.png',
            'https://raw.githubusercontent.com/rikoprushka/NothingForestGuild/main/pixel/JorNorsLife.png',
            'https://raw.githubusercontent.com/rikoprushka/NothingForestGuild/main/pixel/ke1_ng0.png',
            'https://raw.githubusercontent.com/rikoprushka/NothingForestGuild/main/pixel/Lasy_Onion.png',
            'https://raw.githubusercontent.com/rikoprushka/NothingForestGuild/main/pixel/Laurie_Blisse.png',
            'https://raw.githubusercontent.com/rikoprushka/NothingForestGuild/main/pixel/LKlemonX.png',
            'https://raw.githubusercontent.com/rikoprushka/NothingForestGuild/main/pixel/MaOsS_Korn.png',
            'https://raw.githubusercontent.com/rikoprushka/NothingForestGuild/main/pixel/MoMotan_Sumimo.png',
            'https://raw.githubusercontent.com/rikoprushka/NothingForestGuild/main/pixel/mynameiszip.png',
            'https://raw.githubusercontent.com/rikoprushka/NothingForestGuild/main/pixel/Nine3D.png',
            'https://raw.githubusercontent.com/rikoprushka/NothingForestGuild/main/pixel/nohssiw_i.png',
            'https://raw.githubusercontent.com/rikoprushka/NothingForestGuild/main/pixel/PeatCN76.png',
            'https://raw.githubusercontent.com/rikoprushka/NothingForestGuild/main/pixel/ppunchpk_jpeg.png',
            'https://raw.githubusercontent.com/rikoprushka/NothingForestGuild/main/pixel/PuPaDuPP.png',
            'https://raw.githubusercontent.com/rikoprushka/NothingForestGuild/main/pixel/Purgoor.png',
            'https://raw.githubusercontent.com/rikoprushka/NothingForestGuild/main/pixel/RikoPrushka.png',
            'https://raw.githubusercontent.com/rikoprushka/NothingForestGuild/main/pixel/simoence.png',
            'https://raw.githubusercontent.com/rikoprushka/NothingForestGuild/main/pixel/tiwvy.png',
            'https://raw.githubusercontent.com/rikoprushka/NothingForestGuild/main/pixel/V3ntoRies.png',
        ];

        const gameArea = document.getElementById('gameArea');
        const player1 = document.getElementById('player1');
        const player2 = document.getElementById('player2');
        const player1Health = document.getElementById('player1Health');
        const player2Health = document.getElementById('player2Health');
        const player1HPText = document.getElementById('player1HPText');
        const player2HPText = document.getElementById('player2HPText');
        const player1Mana = document.getElementById('player1Mana');
        const player2Mana = document.getElementById('player2Mana');
        const player1ManaText = document.getElementById('player1ManaText');
        const player2ManaText = document.getElementById('player2ManaText');
        const player1Name = document.getElementById('player1Name');
        const player2Name = document.getElementById('player2Name');
        const winnerAnnouncement = document.getElementById('winnerAnnouncement');
        const winnerName = document.getElementById('winnerName');
        const winnerImage = document.getElementById('winnerImage');
        const closeWinnerCard = document.getElementById('closeWinnerCard');
        const battleLog = document.getElementById('battleLog');
        const elapsedTime = document.getElementById('elapsedTime');
        const characterSelection = document.getElementById('characterSelection');
        const characterGrid = document.getElementById('characterGrid');
        const randomSelectBtn = document.getElementById('randomSelectBtn');
        const startGameBtn = document.getElementById('startGameBtn');
        const p1MinDamageInput = document.getElementById('p1MinDamage');
        const p1MaxDamageInput = document.getElementById('p1MaxDamage');
        const p2MinDamageInput = document.getElementById('p2MinDamage');
        const p2MaxDamageInput = document.getElementById('p2MaxDamage');
        const p1MaxHPInput = document.getElementById('p1MaxHP');
        const p2MaxHPInput = document.getElementById('p2MaxHP');
        const countdown = document.getElementById('countdown');
        const selectedCharacterNames = document.getElementById('selectedCharacterNames');
        const refreshBtn = document.getElementById('refreshBtn');

        let player1Data, player2Data;
        let gameInterval;
        let startTime;
        let player1Stats = { damageDealt: 0, healingAmount: 0, manaUsed: 0, emojiThrown: 0 };
        let player2Stats = { damageDealt: 0, healingAmount: 0, manaUsed: 0, emojiThrown: 0 };

        function initCharacterSelection() {
            characterGrid.innerHTML = '';
            characterUrls.forEach((url, index) => {
                const characterButton = createCharacterButton(url, index);
                characterGrid.appendChild(characterButton);
            });
        }

        function createCharacterButton(url, index) {
            const button = document.createElement('div');
            button.innerHTML = `
                <img src="${url}" alt="Character ${index + 1}" class="w-[100px] h-[100px] object-contain mb-2 rounded-lg shadow-lg transition-transform duration-300">
            `;
            button.className = 'character-button bg-gray-800 p-2 rounded-lg cursor-pointer transition duration-300 ease-in-out transform hover:scale-105';
            button.onclick = () => toggleCharacterSelection(url, index, button);
            return button;
        }

        function getCharacterName(url) {
            return url.split('/').pop().split('.')[0];
        }

        function toggleCharacterSelection(url, index, button) {
            if (player1Data && player1Data.index === index) {
                player1Data = null;
                button.classList.remove('ring-4', 'ring-blue-500', 'selected');
                button.querySelector('div')?.remove();
            } else if (player2Data && player2Data.index === index) {
                player2Data = null;
                button.classList.remove('ring-4', 'ring-red-500', 'selected');
                button.querySelector('div')?.remove();
            } else if (!player1Data) {
                player1Data = { url, index };
                updateCharacterSelection('P1', index, button);
            } else if (!player2Data && index !== player1Data.index) {
                player2Data = { url, index };
                updateCharacterSelection('P2', index, button);
            }
            updateSelectedCharacterNames();
            startGameBtn.disabled = !(player1Data && player2Data);
        }

        function updateCharacterSelection(player, index, button) {
            button.classList.add(player === 'P1' ? 'ring-4' : 'ring-4', player === 'P1' ? 'ring-blue-500' : 'ring-red-500', 'selected');
            const label = document.createElement('div');
            label.textContent = player;
            label.className = `absolute top-0 left-0 bg-${player === 'P1' ? 'blue' : 'red'}-500 text-white px-2 py-1 text-xs rounded-br`;
            button.appendChild(label);
        }

        function updateSelectedCharacterNames() {
            let names = [];
            if (player1Data) names.push(`P1: ${getCharacterName(player1Data.url)}`);
            if (player2Data) names.push(`P2: ${getCharacterName(player2Data.url)}`);
            selectedCharacterNames.textContent = names.join(' vs ');
        }

        function randomSelection() {
            const availableIndices = characterUrls.map((_, index) => index).filter(index => index !== (player1Data?.index ?? -1) && index !== (player2Data?.index ?? -1));
            if (availableIndices.length > 0) {
                const randomIndex = availableIndices[Math.floor(Math.random() * availableIndices.length)];
                const button = characterGrid.children[randomIndex];
                toggleCharacterSelection(characterUrls[randomIndex], randomIndex, button);
            }
        }

        function startGame() {
            const p1MinDamage = parseInt(p1MinDamageInput.value);
            const p1MaxDamage = parseInt(p1MaxDamageInput.value);
            const p2MinDamage = parseInt(p2MinDamageInput.value);
            const p2MaxDamage = parseInt(p2MaxDamageInput.value);
            const p1MaxHP = parseInt(p1MaxHPInput.value);
            const p2MaxHP = parseInt(p2MaxHPInput.value);

            player1Data = {
                ...player1Data,
                health: p1MaxHP,
                maxHealth: p1MaxHP,
                name: getCharacterName(player1Data.url),
                minDamage: p1MinDamage,
                maxDamage: p1MaxDamage,
                mana: 100,
                maxMana: 100
            };
            player2Data = {
                ...player2Data,
                health: p2MaxHP,
                maxHealth: p2MaxHP,
                name: getCharacterName(player2Data.url),
                minDamage: p2MinDamage,
                maxDamage: p2MaxDamage,
                mana: 100,
                maxMana: 100
            };

            player1.style.backgroundImage = `url('${player1Data.url}')`;
            player2.style.backgroundImage = `url('${player2Data.url}')`;

            player1Name.textContent = player1Data.name;
            player2Name.textContent = player2Data.name;

            updateHealth(player1Health, player1HPText, player1Data.health, player1Data.maxHealth);
            updateHealth(player2Health, player2HPText, player2Data.health, player2Data.maxHealth);
            updateMana(player1Mana, player1ManaText, player1Data.mana, player1Data.maxMana);
            updateMana(player2Mana, player2ManaText, player2Data.mana, player2Data.maxMana);

            characterSelection.style.display = 'none';
            gameArea.classList.remove('hidden');

            startCountdown();
        }

        function startCountdown() {
            let count = 3;
            countdown.classList.remove('hidden');
            const countdownInterval = setInterval(() => {
                countdown.textContent = count;
                count--;
                if (count < 0) {
                    clearInterval(countdownInterval);
                    countdown.classList.add('hidden');
                    initGame();
                }
            }, 1000);
        }

        function initGame() {
            battleLog.innerHTML = '';
            logBattleAction('Fight!');

            startTime = Date.now();
            startGameLoop();
            updateElapsedTime();
        }

        function startGameLoop() {
            gameInterval = setInterval(() => {
                aiAction(player1Data, player2Data, player1, player2);
                aiAction(player2Data, player1Data, player2, player1);
                updateElapsedTime();
            }, 2000);
        }

        function updateHealth(healthBar, healthText, health, maxHealth) {
            const percentage = (health / maxHealth) * 100;
            healthBar.style.width = `${percentage}%`;
            healthText.textContent = `${health}/${maxHealth}`;
        }

        function updateMana(manaBar, manaText, mana, maxMana) {
            const percentage = (mana / maxMana) * 100;
            manaBar.style.width = `${percentage}%`;
            manaText.textContent = `${mana}/${maxMana}`;
        }

        function updateElapsedTime() {
            const elapsedSeconds = Math.floor((Date.now() - startTime) / 1000);
            const minutes = Math.floor(elapsedSeconds / 60);
            const seconds = elapsedSeconds % 60;
            elapsedTime.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function attack(attacker, defender, attackerElement, defenderElement) {
            const damage = Math.floor(Math.random() * (attacker.maxDamage - attacker.minDamage + 1)) + attacker.minDamage;
            defender.health = Math.max(0, defender.health - damage);

            updateHealth(
                defender === player1Data ? player1Health : player2Health,
                defender === player1Data ? player1HPText : player2HPText,
                defender.health,
                defender.maxHealth
            );
            showDamageText(defenderElement, damage);
            animateAttack(attackerElement, defenderElement);

            logBattleAction(`${attacker.name} attacks ${defender.name} for ${damage} damage!`);

            if (attacker === player1Data) {
                player1Stats.damageDealt += damage;
            } else {
                player2Stats.damageDealt += damage;
            }

            // Mana regeneration for the defender
            defender.mana = Math.min(defender.maxMana, defender.mana + 5);
            updateMana(
                defender === player1Data ? player1Mana : player2Mana,
                defender === player1Data ? player1ManaText : player2ManaText,
                defender.mana,
                defender.maxMana
            );

            if (defender.health === 0) {
                announceWinner(attacker, defender, attackerElement, defenderElement);
            }
        }

        function throwEmoji(attacker, defender, attackerElement, defenderElement) {
            if (attacker.mana < 25) {
                logBattleAction(`${attacker.name} doesn't have enough mana to throw an item!`);
                return false;
            }

            const emojis = ['🧲', '🧸', '🧻', '💣', '🐬', '📱', '👟', '🩲', '🌵', '💩', '⚽', '🏀', '🎮', '🍌', '🍕', '🍰', '🥚', '🦴', '🎤', '📔', '🖱️', '💸', '🐍', '✝️'];
            const emoji = emojis[Math.floor(Math.random() * emojis.length)];
            const damage = Math.floor((Math.random() * (attacker.maxDamage - attacker.minDamage + 1) + attacker.minDamage) * 3);

            defender.health = Math.max(0, defender.health - damage);
            attacker.mana -= 25;

            updateHealth(
                defender === player1Data ? player1Health : player2Health,
                defender === player1Data ? player1HPText : player2HPText,
                defender.health,
                defender.maxHealth
            );
            updateMana(
                attacker === player1Data ? player1Mana : player2Mana,
                attacker === player1Data ? player1ManaText : player2ManaText,
                attacker.mana,
                attacker.maxMana
            );

            showEmojiAnimation(attackerElement, defenderElement, emoji);
            showDamageText(defenderElement, damage);

            logBattleAction(`${attacker.name} throws ${emoji} at ${defender.name} for ${damage} damage!`);

            if (attacker === player1Data) {
                player1Stats.damageDealt += damage;
                player1Stats.manaUsed += 25;
                player1Stats.emojiThrown++;
            } else {
                player2Stats.damageDealt += damage;
                player2Stats.manaUsed += 25;
                player2Stats.emojiThrown++;
            }

            if (defender.health === 0) {
                announceWinner(attacker, defender, attackerElement, defenderElement);
            }

            return true;
        }

        function defend(player, playerElement) {
            const healAmount = Math.floor(player.maxHealth * 0.05);
            player.health = Math.min(player.maxHealth, player.health + healAmount);

            updateHealth(
                player === player1Data ? player1Health : player2Health,
                player === player1Data ? player1HPText : player2HPText,
                player.health,
                player.maxHealth
            );

            playerElement.classList.add('heal');
            setTimeout(() => playerElement.classList.remove('heal'), 1000);

            showHealText(playerElement, healAmount);

            logBattleAction(`${player.name} defends and heals for ${healAmount} HP!`);

            if (player === player1Data) {
                player1Stats.healingAmount += healAmount;
            } else {
                player2Stats.healingAmount += healAmount;
            }
        }

        function showDamageText(element, damage) {
            const damageText = document.createElement('div');
            damageText.textContent = `-${damage}`;
            damageText.className = 'damage-text';
            damageText.style.left = `${element.offsetLeft + element.offsetWidth / 2}px`;
            damageText.style.top = `${element.offsetTop + element.offsetHeight / 4}px`;
            gameArea.appendChild(damageText);
            setTimeout(() => damageText.remove(), 1000);
        }

        function showHealText(element, healAmount) {
            const healText = document.createElement('div');
            healText.textContent = `+${healAmount}`;
            healText.className = 'heal-text';
            healText.style.left = `${element.offsetLeft + element.offsetWidth / 2}px`;
            healText.style.top = `${element.offsetTop + element.offsetHeight / 4}px`;
            gameArea.appendChild(healText);
            setTimeout(() => healText.remove(), 1000);
        }

        function animateAttack(attackerElement, defenderElement) {
            if (attackerElement === player1) {
                attackerElement.classList.add('attack-right');
                setTimeout(() => attackerElement.classList.remove('attack-right'), 300);
            } else {
                attackerElement.classList.add('attack-left');
                setTimeout(() => attackerElement.classList.remove('attack-left'), 300);
            }

            defenderElement.classList.add('hit');
            setTimeout(() => defenderElement.classList.remove('hit'), 200);
        }

        function showEmojiAnimation(attackerElement, defenderElement, emoji) {
            const emojiElement = document.createElement('div');
            emojiElement.textContent = emoji;
            emojiElement.className = 'emoji';
            
            const startLeft = attackerElement.offsetLeft + attackerElement.offsetWidth / 2;
            const startTop = attackerElement.offsetTop + attackerElement.offsetHeight / 2;
            emojiElement.style.left = `${startLeft}px`;
            emojiElement.style.top = `${startTop}px`;
            
            gameArea.appendChild(emojiElement);

            emojiElement.offsetHeight;

            const endLeft = defenderElement.offsetLeft + defenderElement.offsetWidth / 2;
            const endTop = defenderElement.offsetTop + defenderElement.offsetHeight / 2;
            emojiElement.style.left = `${endLeft}px`;
            emojiElement.style.top = `${endTop}px`;
            emojiElement.style.transform = 'scale(2)';

            setTimeout(() => emojiElement.remove(), 2000);
        }

        function aiAction(aiPlayer, opponent, aiElement, opponentElement) {
            if (aiPlayer.health === 0 || opponent.health === 0) return;

            const action = Math.random();
            if (aiPlayer.mana >= 24 && action < 0.6) {
                throwEmoji(aiPlayer, opponent, aiElement, opponentElement);
            } else if (action < 0.8) {
                attack(aiPlayer, opponent, aiElement, opponentElement);
            } else {
                defend(aiPlayer, aiElement);
            }
        }

        function announceWinner(winner, loser, winnerElement, loserElement) {
            clearInterval(gameInterval);
            winnerName.textContent = winner.name;
            winnerImage.src = winner.url;

            loserElement.classList.add('collapsed');
            loserElement.style.filter = 'grayscale(100%)';
            winnerElement.classList.add('jump');
            addSparkles(winnerElement);

            const winnerStats = winner === player1Data ? player1Stats : player2Stats;
            const loserStats = winner === player1Data ? player2Stats : player1Stats;

            document.getElementById('damageDealt').innerHTML = `
            <div style="text-align: center;">
              <span style="color: red;">Damage Dealt</span> <br>
              ${winner.name} ${winnerStats.damageDealt} vs ${loserStats.damageDealt} ${loser.name}
            </div>`;

            document.getElementById('healingAmount').innerHTML = `
            <div style="text-align: center;">
              <span style="color: #76FF03;">Healing Amount</span> <br>
              ${winner.name} ${winnerStats.healingAmount} vs ${loserStats.healingAmount} ${loser.name}
            </div>`;

            document.getElementById('emojiThrown').innerHTML = `
            <div style="text-align: center;">
              <span style="color: #FFFF00;">Items Thrown</span> <br>
              ${winner.name} ${winnerStats.emojiThrown} vs ${loserStats.emojiThrown} ${loser.name}
            </div>`;

            document.getElementById('manaUsed').innerHTML = `
            <div style="text-align: center;">
              <span style="color: #18FFFF;">Mana Used</span> <br>
              ${winner.name} ${winnerStats.manaUsed} vs ${loserStats.manaUsed} ${loser.name}
            </div>`;

            setTimeout(() => {
                winnerAnnouncement.style.display = 'flex';
            }, 2000);

            logBattleAction(`${winner.name} wins the duel!`);
        }

        function addSparkles(element) {
            for (let i = 0; i < 20; i++) {
                const sparkle = document.createElement('div');
                sparkle.className = 'sparkle';
                sparkle.style.left = `${Math.random() * element.offsetWidth}px`;
                sparkle.style.top = `${Math.random() * element.offsetHeight}px`;
                element.appendChild(sparkle);
            }
        }

        function logBattleAction(message) {
            const logEntry = document.createElement('p');
            logEntry.className = 'mb-1';
        
            if (message.includes("doesn't have enough mana")) {
                logEntry.style.color = '#FF0000'; // Red color for insufficient mana messages
            } else if (message.includes('attacks')) {
                logEntry.style.color = '#FAFAFA';
            } else if (message.includes('heals')) {
                logEntry.style.color = '#76FF03';
            } else if (message.includes('throws')) {
                logEntry.style.color = '#FFFF00';
            } else if (message.includes('wins')) {
                logEntry.classList.add('rainbow-text'); // Apply rainbow animation
            } else {
                logEntry.style.color = '#ffffff';
            }
        
            logEntry.textContent = message;
            battleLog.appendChild(logEntry);
            battleLog.scrollTop = battleLog.scrollHeight;
        }

        function resetGame() {
            clearInterval(gameInterval);
            player1.classList.remove('jump', 'attack-right', 'hit', 'heal', 'collapsed');
            player2.classList.remove('jump', 'attack-left', 'hit', 'heal', 'collapsed');
            player1.style.transform = 'translateX(-50%) scaleX(-1)';
            player2.style.transform = 'translateX(50%)';
            player1.querySelectorAll('.sparkle').forEach(s => s.remove());
            player2.querySelectorAll('.sparkle').forEach(s => s.remove());
            battleLog.innerHTML = '';
            winnerAnnouncement.style.display = 'none';
            gameArea.classList.add('hidden');
            characterSelection.style.display = 'flex';
            player1Data = null;
            player2Data = null;
            player1Stats = { damageDealt: 0, healingAmount: 0, manaUsed: 0, emojiThrown: 0 };
            player2Stats = { damageDealt: 0, healingAmount: 0, manaUsed: 0, emojiThrown: 0 };
            startGameBtn.disabled = true;
            updateSelectedCharacterNames();
        }

        function handleKeyPress(event) {
            if (event.key.toLowerCase() === 'b') {
                window.location.href = 'index.html';
            }
        }

        const howToPlayMenu = document.getElementById('howToPlayMenu');
        const closeHowToPlayBtn = howToPlayMenu.querySelector('.close-btn');

        function toggleHowToPlay() {
            howToPlayMenu.style.display = howToPlayMenu.style.display === 'none' ? 'block' : 'none';
        }

        function handleKeyPress(event) {
            if (event.key.toLowerCase() === 'b') {
                window.location.href = 'index.html';
            } else if (event.key.toLowerCase() === 'h') {
                toggleHowToPlay();
            }
        }

        document.addEventListener('keydown', handleKeyPress);
        closeHowToPlayBtn.addEventListener('click', toggleHowToPlay);

        document.addEventListener('keydown', handleKeyPress);

        randomSelectBtn.onclick = () => {
            if (!player1Data) {
                randomSelection();
            }
            if (!player2Data) {
                randomSelection();
            }
        };
        startGameBtn.onclick = startGame;
        closeWinnerCard.onclick = () => {
            winnerAnnouncement.style.display = 'none';
        };
        refreshBtn.onclick = () => {
            location.reload();
        };

        // Initialize the game
        initCharacterSelection();
    </script>
</body>
</html>